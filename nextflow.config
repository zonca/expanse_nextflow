profiles {
  slurm_debug {
    workDir = "/expanse/lustre/scratch/${System.env.USER}/temp_project/nxf_work"
    params.outdir = "/expanse/lustre/scratch/${System.env.USER}/temp_project/results_debug"

    process {
      executor = 'slurm'
      queue    = 'debug'
      time     = '00:10:00'
      cpus     = 2
      memory   = '4 GB'

      clusterOptions = '--account=sds166 -o logs/%x-%j.out -e logs/%x-%j.err'

      // Use node-local scratch on Expanse
      scratch = true
      beforeScript = '''
        set -euo pipefail
        export SCRATCH_DIR="/scratch/$USER/job_${SLURM_JOB_ID}"
        mkdir -p "$SCRATCH_DIR/tmp"
        export TMPDIR="$SCRATCH_DIR/tmp"
        export NXF_OPTS="-Djava.io.tmpdir=$TMPDIR"
        echo "[NF] Using node-local scratch at: $SCRATCH_DIR"
      '''
    }

    singularity {
      enabled = true
      autoMounts = true
      runOptions = '--env TMPDIR=$TMPDIR'
    }

    timeline { enabled = true; file = "nextflow_slurm_executor_timeline.html" }
    report   { enabled = true; file = "nextflow_slurm_executor_report.html"   }
    trace    { enabled = true; file = "nextflow_slurm_executor_trace.txt"     }
    dag      { enabled = true; file = "nextflow_slurm_executor_flowchart.png" }
  }
}
